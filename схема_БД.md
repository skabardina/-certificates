<h1>Проектирование БД</h1>

БД должна содержать информацию о сотрудниках компании, заявках на справки и их черновиках.

Для создание ER-модели необходимо выделить сущности и их атрибуты.

<h3>Сущности</h3>

*Пользователи*  (данные для аутентификации)
- id пользователя
- роль
- логин
- хэш пароля
- дата создания
  
*Сотрудник* (данные о пользователях системы)
- id сотрудника
- id пользователя 
- полное имя
- табельный номер
- подразделение
- должность
- дата приема на работу
- дата увольнения
  
*Справки* (информация о типах справок, доступных к заказу)
- id типа справки
- название справки
- описание
- требования к оформлению
- формируется ли автоматически

*Заявки* (заявки на справки)
- id заявки
- id сотрудника, заказавшего справку 
- id типа справки 
- статус заявки
- комментарий
- дата создания заявки
- дата последнего изменения

*Файлы справок* (информация о сформированных справках)
- id файла
- id заявки 
- ссылка на файл
- дата загрузки

*Черновик* (информация о сохраненных, но не отправленных заявках)
- id черновика
- id сотрудника, заказавшего справку 
- id типа справки 
- комментарий
- дата сохранения

*Уведомления* (история уведомлений, отправленных сотрудникам)
- id уведомления
- id сотрудника, заказавшего справку 
- id заявки (если связано с заявкой)
- текст уведомления

*История изменения заявок* (история изменения статусов заявок)
- id записи
- id заявки 
- новый статус
- кто изменил
- дата изменения

***ER-диаграмма***
![image](https://github.com/skabardina/-certificates/blob/main/ER-diagram.png)

<h3>Анализ задач и круга пользователей</h3>

***Администратор***

Основые задачи:
- управление пользователями и сотрудниками
- выдача прав доступа
- управление типами справок
- доступ ко всей истории изменений
- получение информации о справках, файлах, заявках, черновиках
- управление уведомлениями

***Сотрудник***

Основые задачи:
- создание новых заявок на справку
- сохранение черновиков
- получение списков всех черновиков и заявок персонально
- получение файлов, связанных с заявками
- получение уведомлений о статусе заявки

***Бухгалтер (HR)***

Основые задачи:
- обработка заявок на справки
- генерация справок для сотрудников
- упраление файлами справок (загрузка, удаление)
- просмотр заявок сотрудников и изменение их статусов
- просмотр истории измененний заявок
- отправка уведомлений о готовности справок 
- сохранение черновиков
- получение списков всех черновиков и заявок персонально
- получение файлов, связанных с заявками
- получение уведомлений о статусе заявки

<h3>Выбор СУБД</h3>

Исходя из требований к целостности и согласованности данных, а так же наличия четко определенных связей между сущностями, целесообразно использовать реляционную БД. Данный подход обеспечивает поддержку транзакций, а также удобную работу с запросами. Кроме того реляционная модель позволяет эффективно управлять изменениями структуры данных, обеспечивая надежность и предсказуемость при расширении функциональности системы. Таким образом, физическое проектирование будет выполнено с использованием СУБД PostgeSQL версии 17.4

<details>

**<summary>Структура БД</summary>**

Таблица 1. Пользователи (users)
| Название атрибута | Тип данных | Обязательность | Ограничения | Описание |
|------------------|-----------|--------------|-------------|----------|
| id | UUID | Да | PRIMARY KEY | Уникальный идентификатор пользователя |
| email | VARCHAR(255) | Да | UNIQUE | Email пользователя |
| password_hash | VARCHAR(255) | Да | | Хэш пароля |
| created_at | TIMESTAMP | Да | DEFAULT NOW() | Дата регистрации |
| updated_at | TIMESTAMP | Нет | | Дата последнего обновления |

Таблица 2. Сотрудники (employees)
| Название атрибута | Тип данных | Обязательность | Ограничения | Описание |
|------------------|-----------|--------------|-------------|----------|
| id | UUID | Да | PRIMARY KEY | Уникальный идентификатор сотрудника |
| user_id | UUID | Да | UNIQUE, FOREIGN KEY → users(id) | Связь с пользователем (1:1) |
| full_name | VARCHAR(255) | Да | | Полное имя сотрудника |
| employee_number | VARCHAR(50) | Да | UNIQUE | Табельный номер |
| department | VARCHAR(255) | Да | | Подразделение |
| position | VARCHAR(255) | Да | | Должность |
| hire_date | DATE | Да | | Дата приема на работу |
| termination_date | DATE | Нет | | Дата увольнения |

Таблица 3. Справки (documents)
| Название атрибута | Тип данных | Обязательность | Ограничения | Описание |
|------------------|-----------|--------------|-------------|----------|
| id | VARCHAR(10) | Да | PRIMARY KEY | Уникальный идентификатор документа |
| name | VARCHAR(255) | Да | | Название документа (например, «Справка о доходах») |
| description| VARCHAR | Да | | Описание документа|
| requirements | VARCHAR | Да | | Требования для получения документа |
| auto_generated | BOOL | Да | DEFAULT FALSE | Генерируется ли документ автоматически |

Таблица 4. Заявки (requests)
| Название атрибута | Тип данных | Обязательность | Ограничения | Описание |
|------------------|-----------|--------------|-------------|----------|
| id | VARCHAR(10) | Да | PRIMARY KEY | Уникальный идентификатор заявки |
| employee_id | UUID | Да | FOREIGN KEY → employees(id) | Сотрудник, заказавший справку |
| document_id | VARCHAR(10) | Да | FOREIGN KEY → documents(id) | Тип справки |
| status | ENUM | Да | | Статус заявки |
| comment | TEXT | Нет | | Комментарий |
| created_at | TIMESTAMP | Да | DEFAULT NOW() | Дата создания заявки |
| updated_at | TIMESTAMP | Нет | | Дата последнего изменения |

Таблица 5. Файлы справок (files)
| Название атрибута | Тип данных | Обязательность | Ограничения | Описание |
|------------------|-----------|--------------|-------------|----------|
| id | VARCHAR(10) | Да | PRIMARY KEY | Уникальный идентификатор файла |
| request_id |VARCHAR(10) | Да | UNIQUE, FOREIGN KEY → requests(id) | Связь с заявкой (1:1) |
| file_path | VARCHAR(500) | Да | | Путь к файлу в хранилище |
| uploaded_at | TIMESTAMP | Да | DEFAULT NOW() | Дата загрузки |

Таблица 6. Черновики (drafts)
| Название атрибута | Тип данных | Обязательность | Ограничения | Описание |
|------------------|-----------|--------------|-------------|----------|
| id | VARCHAR(10) | Да | PRIMARY KEY | Уникальный идентификатор черновика |
| employee_id | UUID | Да | FOREIGN KEY → employees(id) | Ссылка на сотрудника |
| document_type | VARCHAR(255) | Да | | Тип документа |
| created_at | TIMESTAMP | Да | DEFAULT NOW() | Дата создания черновика |
| updated_at | TIMESTAMP | Нет | | Дата последнего обновления |

Таблица 7. Уведомления (notifications) **Поправить атрибуты**
| Название атрибута | Тип данных | Обязательность | Ограничения | Описание |
|------------------|-----------|--------------|-------------|----------|
| id | VARCHAR(10) | Да | PRIMARY KEY | Уникальный идентификатор уведомления |
| request_id | VARCHAR(10) | Нет | FOREIGN KEY → requests(id) | Связь с заявкой (если применимо) |
| changed_by | UUID | Да | FOREIGN KEY → employees(id) | Сотрудник, получивший уведомление |
| new_status | VARCHAR (50)  | Нет |  | Обновленный статус |
| sent_at | TIMESTAMP | Да | DEFAULT NOW() | Дата отправки |
| comment | VARCHAR (500) | Да | | Текст уведомления |

### Таблица `change_history` (История изменений заявок)
| Название атрибута | Тип данных | Обязательность | Ограничения | Описание |
|------------------|-----------|--------------|-------------|----------|
| id | UUID | Да | PRIMARY KEY | Уникальный идентификатор записи |
| request_id | UUID | Да | FOREIGN KEY → requests(id) | Связь с заявкой |
| changed_by | UUID | Да | FOREIGN KEY → employees(id) | Кто внес изменения |
| change_type | VARCHAR(255) | Да | | Тип изменения (создание, обновление, удаление) |
| change_timestamp | TIMESTAMP | Да | DEFAULT NOW() | Дата изменения |


</details>
